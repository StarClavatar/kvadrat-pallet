# Kvadrat Pallet - React + TypeScript + Vite

Приложение для управления палетизацией с поддержкой сканирования штрихкодов через терминалы сбора данных.

## Системные требования

- **Node.js**: версия 18.20.2 или выше
- **Менеджер пакетов**: npm или yarn
- **Терминал сбора данных**: настроенный для работы с приложением (см. раздел "Настройка оборудования")

> **Рекомендация**: Для управления версиями Node.js используйте [NVM](https://habr.com/ru/companies/timeweb/articles/541452/)

## Установка и запуск

### 1. Клонирование репозитория

```bash
# Скопируйте HTTPS-ссылку из GitHub (кнопка "<>Code" → "HTTPS")
git clone https://github.com/StarClavatar/kvadrat-pallet.git

# Перейдите в директорию проекта
cd kvadrat-pallet
```

### 2. Установка зависимостей

```bash
# Используйте npm
npm install

# Или yarn
yarn install
```

### 3. Запуск проекта

```bash
# Development-режим
npm run dev
# или
yarn dev
```

### Доступ к приложению

После запуска приложение будет доступно:

- **Локально**: `http://localhost:5173`
- **В локальной сети**: При использовании флага `--host` (настроен в `package.json`) приложение станет доступно по IP-адресу компьютера

**Пример вывода команды `yarn dev`:**

```bash
yarn run v1.22.22
$ vite --host

  ➜  Local:   http://localhost:5173/
  ➜  Network: http://10.10.79.120:5173/ 
  ➜  Network: http://172.16.9.1:5173/
  ➜  press h + enter to show help
```

> **Для ТСД**: Используйте Network-адрес для доступа к приложению с терминала сбора данных в той же локальной сети.


## Настройка оборудования

### Конфигурация терминала сбора данных

Для корректной работы сканирования необходимо настроить терминал сбора данных:

#### Обязательные настройки:

**Symbology Settings (Типы кодов):**
- ✅ **Data Matrix** — должен быть включен (обычно включен по умолчанию)

**Output Settings (Настройки вывода):**
- **Output Mode**: `Physical Keyboard` или `Auto`
- ❌ **Output via Intent** — отключить
- ❌ **Clipboard** — отключить
- ❌ **Action Key Character** — отключить

> **Важно**: Некорректная настройка терминала может привести к нерабочему сканированию или дублированию символов.

## Техническая документация

### Библиотека сканирования

Проект использует библиотеку `@use-symbology-scanner/react` для обработки штрихкодов. Однако в процессе разработки была выявлена критическая проблема с React Router.

### Проблема с событиями клавиатуры в React

**Описание проблемы:**
При навигации между страницами в React-приложении (используя React Router) события клавиатуры от терминала сбора данных перестают обрабатываться. Это происходит из-за особенностей жизненного цикла компонентов и управления фокусом в браузере.

**Симптомы:**
- Сканирование работает при первом заходе на страницу
- После навигации на другую страницу и возврата сканирование не функционирует
- События `keydown` не поступают в обработчики

### Решение

**Реализованное решение:**
Создан кастомный хук `useCustomScanner`, который решает проблему принудительного рендера компонента.

**Ключевые моменты реализации:**

1. **Принудительный setState при монтировании:**
   ```tsx
   const [code, setCode] = useState(" "); // Не пустая строка и не 0, null undefined!
   ```
   
2. **Обязательный рендер для активации событий:**
   При рендере страницы необходимо выполнить любой `setState` с непустым значением (например, `setState(" ")`). Это критически важно для активации слушателей событий клавиатуры.

3. **Использование кастомного хука:**
   ```tsx
   import { useCustomScanner } from "../../hooks/useCustomScanner";
   
   const handleScan = (symbol: string) => {
     setCode(symbol);
     console.log("Отсканированный код:", symbol);
   };
   
   useCustomScanner(handleScan);
   ```

### Важные замечания

- **Никогда не используйте пустые значения** (`""`, `0`, `null`, `undefined`) как начальное значение состояния для полей, связанных со сканированием
- **Всегда инициализируйте состояние** пробелом или другим непустым значением: `useState(" ")`
- **Принудительный рендер обязателен** — без него события клавиатуры не будут работать даже при правильной настройке оборудования

## Структура проекта

```
src/
├── api/              # API методы для работы с бэкендом
├── components/       # Переиспользуемые компоненты
├── hooks/           # Кастомные хуки (включая useCustomScanner)
├── pages/           # Страницы приложения
├── context/         # React Context для глобального состояния
└── assets/          # Статические ресурсы
```

## Устранение неполадок

**Сканирование не работает:**
1. Проверьте настройки терминала сбора данных
2. Убедитесь, что начальное состояние компонента не пустое
3. Проверьте, что используется `useCustomScanner` вместо стандартного хука

**События клавиатуры не поступают:**
1. Откройте DevTools → Console
2. Проверьте, срабатывают ли события `keydown`
3. Убедитесь, что компонент прошел принудительный рендер

## Разработка

### Тестирование сканирования

Для тестирования функциональности сканирования используйте страницу `/test-mode`, которая показывает:
- Количество рендеров компонента
- Текущее отсканированное значение
- Возможность ручного ввода для отладки





